
> 最近做 CodeReview ，发现了一些问题，总结一下

## 单一职责

在页面功能复杂，元素很多，一定要按业务划分多个组件，组件要做到单一职责，父级容器仅负责布局，布局相关逻辑，这样，组件负责业务，容器负责布局，都做到了单一职责。

组件间相关隔离，单一职责，容易测试和定位问题，容易相互协作，架构设计的目标是尽可能做到多人并行工作，提高协作效率，结果就是可以保证交付时间，以及降低后期维护成本。

## 滥用 State

只有引起 UI 变化的数据才放到 State 里，其他变量可以使用对象属性，或者模块内变量，不要全部使用 State，不要有思维定式。

State 的更新是异步的，更新 State 后如果要拿到新的 State ，要在回调里执行后续逻辑。

## 轮询方案

如果需要轮询调用接口，不要使用 setInterval，确保前一个请求返回，或者报异常后调用下一个接口，setInterval 容易导致同时发出多个请求的情况。

如果要延迟一段时间，轮询里加上 setTimeout 延迟发出下一个请求。

轮询也可以抽出一个方法，做到单一职责，比如抽出一个 loop 方法

```js
loop = async (cb) => {
    const me = this;
    if(!cb) {
        return;
    }
    const isRun = await cb();
    if(!isRun){
        return;
    }
    me.timer = setTimeout(async () => {
        if (me.timer) {
            clearTimeout(me.timer);
        }
        await me.loop(cb);
    }, 1000);
}
```

使用

```js
loop(async ()=>{
    // 一个轮询请求内的业务代码
    // 返回true，轮询继续，
    // 返回false,退出轮询
})
```

## 主逻辑清晰

一定要一个主逻辑，提纲挈领，用几个函数将主逻辑说清楚，将业务细化为几个函数，以及函数间的控制关系，就像写 PPT ，将主要的内容抽象出几个大的标题一样，然后依次完成每个函数。

## 函数定义清晰

函数的定义有三个点可以很好的描述函数的功能，首先是函数名，然后是参数，最后是函数注释。

函数名尽量贴近业务，参数尽量不要传对象，参数少的话要展开，参数多的话，要加注释，如果用 TS 的话，给参数加个类型定义。

```js
// 完全看不出业务
getData(params)

// 推荐
getJobList(keyword:string,city:string);
getJobList({keywor,city});
getJobList(params:IParams);
```

## 持续重构

随着业务演进，单个模块的业务会不断增加，逻辑也会不断复杂，原有设计不能满足需求，代码的维护性会变差，，如果在原有设计上更改，会发现很别扭，有可能让代码变成一坨。

重构的目标是代码清晰，可维护。
